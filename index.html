<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Critter World</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<script src="js/lib/jquery-1.7.2.min.js"></script>
		<link rel="stylesheet" type="text/css" href="style.css">

		<script src="js/utils.js"></script>
		<script src="http://threejs.org/build/three.js"></script>
		<script src="http://threejs.org/examples/js/Detector.js"></script>
		<script src="http://threejs.org/examples/js/libs/stats.min.js"></script>

	</head>
	<body>
		<div id="page">
			<div id= "menubar">
				<div id="logo">
					Critter World
				</div>

				<div id="menu-items" style="float:left; display:inline;">
					<div class="menu-item">
						World
					</div>
					<div class="menu-item">
						File
					</div>
					<div class="menu-item">
						View
					</div>

				</div>

			</div>
			<div id="main">
				<div id="world">

				</div>
				<div id="control-pane">
					<div id="header">
						World Stats:
					</div>
					<div id= "world-stats">
						<div class="stat">
							<span class="stat-label">Critter Count: </span><span class="stat-data" id="critter-count">0</span>
						</div>
						<br>
						<div class="stat">
							<span class="stat-label">Time:</span><span class="stat-data" id = "time-count">0</span>
						</div>
						<br>

						<div class="stat">
							<span class="stat-label">Current Hex: </span><span class="stat-data" id="current-hex">(0,0)</span>
						</div>
						<br>
						<div class="stat">
							<span class="stat-label">Type: </span><span class="stat-data" id="current-hex-type"> </span>
						</div>
					</div>

					<div id="controls"></div>
				</div>
			</div>
		</div>

		<script src="js/World.js"></script>
		<script src="js/Map.js"></script>
		<script src="js/Critter.js"></script>
		<script src="js/lib/TerrainGeneration.js"></script>
		<script src="js/Terrain.js"></script>
	<script id="fragmentShader" type="x-shader/x-fragment">


uniform sampler2D texture_DIF; 
uniform sampler2D texture_NRM; 
uniform sampler2D texture_NRM2; 
uniform int CubeMapIndex;


uniform float FStime;

uniform vec4 ambient;
uniform vec4 diffuse;
uniform vec4 specular;
uniform float shininess;


varying vec2 texture_coordinate;

varying vec3 EyespacePosition;
varying vec3 EyespaceNormal;
varying vec2 TexCoord;


 vec2 mod1(vec2 x) {
 	if(x.x > 1.0 || x.y > 1.0){
   return x - floor(x);
   }else{return x;}
 }


/* Material properties passed from the application. */
uniform vec3 DiffuseColor;
uniform vec3 SpecularColor; 
uniform float PhongExponent;

/* Textures and flags for whether they exist. */
uniform sampler2D DiffuseTexture;
uniform sampler2D SpecularTexture;
uniform sampler2D ExponentTexture;

uniform bool HasDiffuseTexture;
uniform bool HasSpecularTexture;
uniform bool HasExponentTexture;

/* Fragment position and normal, and texcoord, from vertex shader. */


/* Encodes a normalized vector as a vec2. See Renderer.java for more info. */
vec2 encode(vec3 n)
{
    return normalize(n.xy) * sqrt(0.5 * n.z + 0.5);
}

void main()
{
    // Sampling The Texture And Passing It To The Frame Buffer
    vec2 new_texture_coordinate1 =vec2(texture_coordinate.x, mod1(texture_coordinate.y + FStime));
    vec3 n1 = texture2D(texture_NRM,new_texture_coordinate1).xyz;
    
    vec2 new_texture_coordinate2 = mod1(2.*(texture_coordinate + FStime));
    vec3 n2 = texture2D(texture_NRM,new_texture_coordinate2).xyz;
    
    vec2 new_texture_coordinate3 = mod1(4.*(texture_coordinate - FStime));
    vec3 n3 = texture2D(texture_NRM,new_texture_coordinate3).xyz;
    
    vec3 n = normalize(n1+n2+0.5*n3);
    
    n = n.xzy;
    vec2 enc = encode(normalize(n));//EyespaceNormal));
 
     vec4 textureColor = texture2D(texture_DIF,texture_coordinate);

    gl_FragData[0]= vec4(textureColor.xyz, enc.x);

    gl_FragData[1] = vec4(EyespacePosition, enc.y);
    if (HasSpecularTexture)
        gl_FragData[2] = vec4(float(WATER_MATERIAL_ID), 0.0, 0.0, CubeMapIndex);
    else gl_FragData[2] = vec4(float(WATER_MATERIAL_ID), 0.0,0.0,0.0);
    if (HasExponentTexture)
        gl_FragData[3].x = 255.0 * texture2D(ExponentTexture, TexCoord).s;
    else gl_FragData[3] = vec4(PhongExponent, 0.0, 0.0, 0.0);
}

		</script>

		<script id="vertexShader" type="x-shader/x-vertex">



uniform sampler2D texture_DIF; 
uniform sampler2D texture_NRM; 
uniform sampler2D texture_NRM2; 
uniform int CubeMapIndex;

uniform float FStime;
uniform float VStime;
varying float update_dist;
varying float offset;
varying float units_shifted;

uniform vec4 ambient;
uniform vec4 diffuse;
uniform vec4 specular;
uniform float shininess;

varying vec2 texture_coordinate;

attribute vec4 VertexTangent;

varying vec3 EyespacePosition;
varying vec3 EyespaceNormal;
varying vec3 EyespaceTangent;
varying vec3 EyespaceBiTangent;

varying vec2 TexCoord;

 vec2 mod1(vec2 x) {
   return x - floor(x);
 }

void main()
{
	
	EyespacePosition = vec3(gl_ModelViewMatrix * gl_Vertex);
	EyespaceNormal = gl_NormalMatrix * gl_Normal; //normalize(vec3(gl_ModelViewMatrix * vec4(gl_Normal,0)));
	
	EyespaceTangent = normalize(gl_NormalMatrix * VertexTangent.xyz);
	EyespaceBiTangent = normalize(cross(EyespaceNormal,EyespaceTangent));
	
	texture_coordinate = gl_MultiTexCoord0.st;
	vec4 newVertex = gl_Vertex;
	
	// rate of shift, different than ripple time
	
	update_dist = 4.0/65.0;
	offset = mod(VStime,update_dist);
	units_shifted = (VStime - offset);
	newVertex.x += offset;
	
	
	texture_coordinate = vec2(texture_coordinate.x,mod1(texture_coordinate.y - (1.0/2.0)*units_shifted));
	
	
	//texture_coordinate = gl_MultiTexCoord0.st;

	gl_Position = gl_ModelViewProjectionMatrix * newVertex;
	//gl_Position = ftransform();

}









		</script>
		<script src="js/Water.js"></script>
		<script src="js/lib/MouseControls.js"></script>
		<script src="js/CritterControls.js"></script>
		<script src="js/Main.js"></script>

	</body>
</html>
